---
tags: 
draft: true
lastmod: 2024-06-25T11:25:12+08:00
title: 保护模式相关
date: 2024-06-12
---
### 系统调用过程

系统调用是用户空间程序与内核通信的一种机制。用户空间程序通过软中断 (software interrupt) `int 0x80` 进入内核，`eax` 寄存器中包含系统调用号，其他寄存器 (`ebx`, `ecx`, `edx` 等) 中包含系统调用参数。内核接收到系统调用后，进行一系列处理，最终调用对应的系统调用处理函数。

### 段寄存器和选择子

- **选择子 (Selector)**: 用于选择段描述符。每个段描述符包含段基地址、段限长和段属性。
- **段寄存器 (Segment Registers)**: `cs`, `ds`, `es`, `fs`, `gs`, `ss`，用于指向不同的段。
    - **`ds`**: 数据段寄存器，指向当前数据段。
    - **`es`**: 额外段寄存器，通常用于字符串操作。
    - **`fs` 和 `gs`**: 一般用于指向特殊数据段，如线程本地存储 (TLS)。
    - **`cs`**: 代码段寄存器，指向当前执行代码段。
    - **`ss`**: 堆栈段寄存器，指向当前堆栈段。


`%` 符号用于标识寄存器

### 数据寄存器（General Purpose Registers）

数据寄存器用于存储数据或操作数，常见的通用寄存器包括 `ax`, `bx`, `cx`, `dx` 等。这些寄存器可以用于各种运算、数据传输和地址计算。

- **`dx`**:
    - 全称是 Data Register（数据寄存器）。
    - 可以被分为高位和低位部分，即 `dh`（高字节）和 `dl`（低字节）。
    - 作为一个 32 位寄存器时，它被称为 `edx`，可以存储 32 位数据。`e`，extended。
    - 用途广泛，包括 I/O 操作、乘法和除法操作中的数据存储等。

### 段寄存器（Segment Registers）

段寄存器用于存储内存段的基地址。x86 架构使用分段内存模型，通过段寄存器和偏移地址来访问内存。

- **`ds`**:
    - 全称是 Data Segment Register（数据段寄存器）。
    - 用于存储数据段的基地址。数据段通常是程序中存储数据的内存区域。
    - 与数据寄存器（如 `dx`）一起使用，可以通过 `ds:dx` 的形式访问内存中的数据。

其他常见的段寄存器包括：

- **`cs`** (Code Segment): 存储代码段的基地址，指向当前正在执行的代码段。
- **`ss`** (Stack Segment): 存储堆栈段的基地址，指向当前正在使用的堆栈段。
- **`es`** (Extra Segment): 额外段寄存器，用于字符串和数组操作的额外数据段。
- **`fs`** 和 **`gs`**: 通常用于额外的段，操作系统和某些应用程序可以用它们来指向特定的内存区域，如线程本地存储（TLS）。


`pushl` 中的 `l` 表示操作的是 32 位寄存器。

